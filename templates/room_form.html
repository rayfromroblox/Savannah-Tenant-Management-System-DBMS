{% extends "base.html" %}

{% block title %}{% if room %}Edit Room{% else %}Add Room{% endif %} - Hostel Management System{% endblock %}

{% block content %}
<div class="form-container">
    <div class="card-header">
        <h1 class="card-title">{% if room %}Edit Room{% else %}Add New Room{% endif %}</h1>
    </div>
    
    <form method="POST">
        <div class="form-group">
            <label for="room_number" class="form-label">Room Number</label>
            <select id="room_number" name="room_number" class="form-select" required>
                <option value="">Select Room Number</option>
                {% for i in range(1, 25) %}
                <option value="{{ i }}" {% if room and room.room_number == i|string %}selected{% endif %}>
                    Room {{ i }}
                </option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="room_type" class="form-label">Room Type</label>
            <input type="text" id="room_type" name="room_type" class="form-input" 
                   value="{{ room.room_type if room else '' }}" readonly>
        </div>
        
        <div class="form-group">
            <label for="monthly_rent" class="form-label">Monthly Rent (KES)</label>
            <input type="number" id="monthly_rent" name="monthly_rent" class="form-input" 
                   value="{{ room.monthly_rent if room else '' }}" step="0.01" min="0" readonly>
        </div>
        
        <div class="form-actions">
            <a href="{{ url_for('rooms') }}" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn">{% if room %}Update Room{% else %}Add Room{% endif %}</button>
        </div>
    </form>
</div>

<script>
document.getElementById('room_number').addEventListener('change', function() {
    const roomNumber = this.value;
    const roomTypeInput = document.getElementById('room_type');
    const monthlyRentInput = document.getElementById('monthly_rent');
    
    if (roomNumber) {
        // Fetch room information from the API
        fetch(`/api/room/${roomNumber}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Room not found');
                    return;
                }
                roomTypeInput.value = data.room_type;
                monthlyRentInput.value = data.monthly_rent;
            })
            .catch(error => {
                console.error('Error fetching room info:', error);
                alert('Error fetching room information');
            });
    } else {
        roomTypeInput.value = '';
        monthlyRentInput.value = '';
    }
});
</script>
{% endblock %}
